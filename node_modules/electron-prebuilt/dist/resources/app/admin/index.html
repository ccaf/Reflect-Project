<!DOCTYPE html>
<html>
<head>
  <script src="../lib/mithril.min.js"></script>
  <link rel="stylesheet" href="../lib/css/bootstrap.min.css" />

  <script type="text/javascript">
    var urlBase = (typeof require === 'undefined' ? window.location.origin + '/api' : 'http://localhost:1867/api');

    var Navigation = {
      'controller': function() {
        var pages = m.prop([]);

        var addPage = function(page) {
          m.startComputation();

          if (page instanceof Array)
            for (var i = 0; i < page.length; i++)
              pages().push(page[i]);
          else if (page !== null && typeof page !== 'undefined')
            pages().push(page);

          m.route(document.getElementById('page'), '/', pages().reduce(function(acc, cur) {
              return acc[cur.href] = cur.controller, acc;
            }, {}));
          m.endComputation();
        };

        var removePage = function(href) {
          m.startComputation();
          pages().splice(pages().map(function(page) { return page.href; }).indexOf(href), 1);
          addPage(null);
          m.endComputation();
        };

        var activeClassroom = m.prop();

        return {
          'pages': pages,
          'activeClassroom': activeClassroom,
          'addPage': addPage,
          'removePage': removePage
        }
      },
      'view': function(ctrl) {
        return m('ul', {'class': 'nav nav-tabs nav-justified'}, ctrl.pages().map(function(page) {
          return m('li', {'class': (m.route() === page.href ? 'active' : '')}, m('a', {'href': page.href, 'config': m.route}, page.title));
        }));
      }
    }

    var ClassroomSelect = {
      'controller': function() {
        var classrooms = m.request({'method': 'GET', 'url': urlBase + '/classroom'});
        return {
          'classrooms': classrooms
        }
      },
      'view': function(ctrl) {
        return m('ul', ctrl.classrooms().map(function(classroom) {
          return m('li', classroom.name);
        }));
      }
    };

    var DeviceManager = {
      'controller': function() {

      },
      'view': function() {

      }
    };

    window.onload = function() {
      m.route.mode = 'hash';
      var nav = window.nav = m.mount(document.getElementById('navigation'), Navigation);
      nav.addPage([
        {'title': 'Home', 'href': '/', 'controller': ClassroomSelect},
        {'title': 'Devices', 'href': '/devices', 'controller': DeviceManager},
        {'title': 'Users', 'href': '/users'},
        {'title': 'Apps', 'href': '/apps'}
      ]);
    };
  </script>
</head>
<body>
<div id="navigation"></div>
<div id="page"></div>
</body>
</html>
