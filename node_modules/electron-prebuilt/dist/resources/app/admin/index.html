<!DOCTYPE html>
<html>
<head>
  <script src="../lib/mithril.min.js"></script>
  <script type="text/javascript">
    var log = null;
    var conn = new WebSocket('ws://' + (window.location.hostname ? window.location.hostname : 'localhost') + ':904/');
    conn.sendObj = function(channel, message) {
      conn.send(JSON.stringify({'channel': channel, 'message': message}));
    };

    var actionHandler = {
    };

    conn.onmessage = function(json) {
      var message = JSON.parse(json.data);

      m.startComputation();
      log.addMessage(message);
      m.endComputation();
      if (message.channel in actionHandler) actionHandler[message.channel](message);
    };
  </script>

  <script type="text/javascript">
    var Log = {
      'controller': function() {
        var messages = m.prop(['test']);
        return {
          'messages': messages,
          'addMessage': function(message) {
            messages().push(message);
          }
        };
      },
      'view': function(ctrl) {
        return m('div', ctrl.messages().map(function(message) {
          return m('p', JSON.stringify(message));
        }));
      }
    };

    window.onload = function() {
      log = m.mount(document.getElementById('log'), Log);
    };
  </script>
</head>
<body>
<div id="log"></div>
</body>
</html>
